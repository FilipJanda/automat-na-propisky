<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Google Sign-In ukázka</title>

    <!-- TODO: nahraď tímto svým klientským ID -->
    <meta name="google-signin-client_id" content="YOUR_CLIENT_ID.apps.googleusercontent.com">

    <style>
      body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 24px; }
      .container { max-width: 520px; margin: 0 auto; }
      #user-info { margin-top: 16px; border-top: 1px solid #eee; padding-top: 16px; }
      img.profile { border-radius: 50%; display: block; margin-top: 8px; width: 96px; height: 96px; object-fit: cover; }
      button { margin-top: 8px; padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; background: #f7f7f7; cursor: pointer; }
    </style>
</head>
<body>
  <div class="container">
    <!-- Google Sign-In tlačítko -->
    <div class="g-signin2" data-onsuccess="onSignIn"></div>

    <!-- Zde se zobrazí přihlašovací údaje -->
    <div id="user-info" aria-live="polite"></div>
  </div>

  <!-- Google platform knihovna -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>

  <script>
    // Jedna implementace onSignIn — vypíše údaje pod tlačítko a zároveň loguje do konzole
    function onSignIn(googleUser) {
      var profile = googleUser.getBasicProfile();

      // Pokud email vrací null, je potřeba povolit scope 'email' při konfiguraci klienta.
      var id = profile.getId();
      var name = profile.getName();
      var email = profile.getEmail();
      var img = profile.getImageUrl();

      // Vytvoření HTML obsahu pro zobrazení
      var userInfo = `
        <h2>Přihlašovací údaje</h2>
        <p><strong>ID:</strong> ${escapeHtml(id)}</p>
        <p><strong>Jméno:</strong> ${escapeHtml(name)}</p>
        <p><strong>Email:</strong> ${escapeHtml(email || "není k dispozici")}</p>
        ${img ? `<img class="profile" src="${escapeHtml(img)}" alt="Profilová fotka">` : ''}
        <div>
          <button id="signout-btn" type="button">Odhlásit</button>
        </div>
      `;

      document.getElementById('user-info').innerHTML = userInfo;

      // konzole (užitečné pro debug)
      console.log('ID: ' + id);
      console.log('Name: ' + name);
      console.log('Image URL: ' + img);
      console.log('Email: ' + email);

      // připoj handler pro odhlášení
      var btn = document.getElementById('signout-btn');
      if (btn) {
        btn.addEventListener('click', function() {
          signOut();
        });
      }
    }

    // Funkce pro odhlášení (Google Sign-In)
    function signOut() {
      var auth2 = gapi && gapi.auth2 ? gapi.auth2.getAuthInstance() : null;
      if (auth2) {
        auth2.signOut().then(function () {
          document.getElementById('user-info').innerHTML = '<p>Uživatel odhlášen.</p>';
          console.log('User signed out.');
        });
      } else {
        // fallback: pokud auth2 není inicializované, prostě smažeme UI
        document.getElementById('user-info').innerHTML = '<p>Uživatel odhlášen.</p>';
      }
    }

    // Malá helper funkce pro proti XSS — escapuje <>&"
    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // Inicializace gapi.auth2 (volitelné, pomůže s odhlášením)
    function initAuth2() {
      if (!gapi) return;
      if (!gapi.auth2) {
        gapi.load('auth2', function() {
          try {
            gapi.auth2.init({
              client_id: document.querySelector('meta[name="google-signin-client_id"]').content
            });
          } catch (e) {
            console.warn('init auth2 failed', e);
          }
        });
      }
    }

    // počkáme až se platform.js načte a inicializuje auth2
    window.addEventListener('load', function() {
      initAuth2();
    });
  </script>
</body>
</html>
